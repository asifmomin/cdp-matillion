{"job":{"components":{"10181":{"id":10181,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-352,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[10189],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"10182":{"id":10182,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":-225,"y":6,"width":32,"height":32,"inputConnectorIDs":[10189],"outputSuccessConnectorIDs":[10187],"outputFailureConnectorIDs":[10191],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"#!/usr/bin/python3\n##/usr/share/tomcat8/scm\n\nimport urllib\nimport os\nfrom base64 import b64encode\nfrom builtins import bytes\nfrom http import client\nimport logging\n\n\n\n#----------------------------------\n#\n# INPUT FROM THE ORCHESTRATION JOB\n#\n#----------------------------------\n#group=\"NG\"\n#project=\"CDP\"\n#version=\"default\"\n#export_response=\"\" #job variable\n\n#API USER CRED\n#api_user=\"azure-user\"\n#api_password_path=api_password_path\n\n\nlogging.basicConfig(level=logging.INFO,\n                    format='%(asctime)s - [ %(levelname)s ] - %(message)s')\n\nlogging.info(\"#APPLICATION START\")\n\ntry:\n\t#ENCODE required endpoint variables\n\tgroup_encoded = urllib.parse.quote(group)\n\tproject_encoded = urllib.parse.quote(project)\n\n\t#PREPARE User cred for api call\n\tapi_user_password=open(os.path.abspath('{0}/{1}.txt'.format(api_password_path,api_user))).read().strip('\\n')\n\tapi_auth_input=\"{0}:{1}\".format(api_user,api_user_password)\n\tapi_auth_unicode=b64encode(bytes(api_auth_input,'utf-8')).decode('ascii')\n\tapi_auth='Basic {0}'.format(api_auth_unicode)\n\n\tapi_auth_header={\n\t\t\"Authorization\" : api_auth,\n\t\t\"Content-type\" : \"application/json\"\n\t}\nexcept Exception:\n\tlogging.error(\"### exception in Credential initialization ######\")\n\traise\n\n\ntry:\n\t#Matillion Rest API URL [Tomcat Local host]\n\tconnection= client.HTTPConnection(\"127.0.0.1\",'8080')\n\n\tendpoint_schedule=\"/rest/v1/group/name/{0}/project/name/{1}/schedule/export\".format(group_encoded,project_encoded)\t\n\n\tconnection.request(\"GET\",endpoint_schedule,headers=api_auth_header)\n\n\tresponse_out=connection.getresponse().read().decode('utf-8')\n\n\tresponse_out_json=json.loads(response_out)\n\n\tdictJson={}\n\n\tfor key in response_out_json.keys():\n\t\tif(key == \"objects\"):\n\t\t\tfilterDefault=[x for x in response_out_json[key] if x[\"versionName\"]==version]\n\t\t\tdictJson[key]=filterDefault\n\t\telse:\n\t\t\tdictJson[key]=response_out_json[key]\n\nexcept Exception:\n\tlogging.error(\"Exception in the restCall\")\n\traise\n\n# the matillion instance Location.\ntargetPath=\"{0}/schedule_{1}_version.json\".format(target,version)\n\nlogging.info(\"target --> \" + targetPath)\nwith open(targetPath,'w') as f:\n  json.dump(dictJson,f)\n  os.chmod(targetPath.format(target),0o777)\n\nlogging.info(\"#APPLICATION END\")"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"10183":{"id":10183,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":144,"y":128,"width":32,"height":32,"inputConnectorIDs":[10190],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Export Failure"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"10184":{"id":10184,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":144,"y":32,"width":32,"height":32,"inputConnectorIDs":[10188],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Retry Export Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"10185":{"id":10185,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":80,"y":-96,"width":32,"height":32,"inputConnectorIDs":[10187],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Export Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"10186":{"id":10186,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-158614544,"x":-32,"y":80,"width":32,"height":16,"inputConnectorIDs":[10191],"outputSuccessConnectorIDs":[10188],"outputFailureConnectorIDs":[10190],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Retry"}}}},"visible":true},"2":{"slot":2,"name":"Number of Retries","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1"}}}},"visible":true},"3":{"slot":3,"name":"Retry Delay","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Short delay with backoff"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"10187":{"id":10187,"sourceID":10182,"targetID":10185},"10188":{"id":10188,"sourceID":10186,"targetID":10184}},"failureConnectors":{"10190":{"id":10190,"sourceID":10186,"targetID":10183},"10191":{"id":10191,"sourceID":10182,"targetID":10186}},"unconditionalConnectors":{"10189":{"id":10189,"sourceID":10181,"targetID":10182}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"api_password_path":{"definition":{"name":"api_password_path","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"/home/ngpoc/cred"},"api_user":{"definition":{"name":"api_user","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"azure-user"},"group":{"definition":{"name":"group","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"NG"},"project":{"definition":{"name":"project","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"CDP"},"target":{"definition":{"name":"target","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"/home/ngpoc/NG_group/CDP_schedule"},"version":{"definition":{"name":"version","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"default"}},"grids":{}},"info":{"name":"SchedulerExportAPI","description":"Export schedules of the project and place it in the Matillion Repo. \n\nINPUT VARIABLES SAMPLE:\n\n1. group=\"NG\"\n2. project=\"CDP\"\n3. version=\"default\"\n4. api_user=\"azure-user\"\n5. api_user_password_path=\"location in vm\"\n6. Export Path = \"Location in vm\"\n\n\n","type":"ORCHESTRATION","tag":"02362e6e-f337-4180-8201-37a455529a31"}}